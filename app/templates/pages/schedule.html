{% extends "base.html" %}

{% block title %}{{ club.name }} â€“ Schedule{% endblock %}

{% block content %}
<div class="schedule-header">
  <hgroup>
    <h1>{{ club.name }}</h1>
    <p>ğŸ“ {{ club.address }}, {{ club.city }}
      {% if club.website %} Â· <a href="{{ club.website }}" target="_blank">Book on site â†—</a>{% endif %}
    </p>
  </hgroup>
</div>

<!-- Unified toolbar: date nav + filters + legend -->
<div class="schedule-toolbar">
  <!-- Date navigation -->
  <div class="toolbar-section">
    <a href="/clubs/{{ club.id }}/schedule?date={{ prev_date }}" role="button" class="outline">&larr;</a>
    <input type="date" id="date-picker" value="{{ selected_date }}"
           hx-get="/clubs/{{ club.id }}/schedule"
           hx-target="body"
           hx-push-url="true"
           hx-include="[name='surface_type'],[name='court_type']"
           name="date">
    <a href="/clubs/{{ club.id }}/schedule?date={{ next_date }}" role="button" class="outline">&rarr;</a>
    <a href="/clubs/{{ club.id }}/schedule" role="button" class="outline secondary">Today</a>
  </div>

  <div class="toolbar-divider"></div>

  <!-- Filters -->
  <div class="toolbar-section">
    <span class="toolbar-label">Surface</span>
    <select name="surface_type"
            hx-get="/partials/clubs/{{ club.id }}/slots"
            hx-target="#slot-grid"
            hx-include="[name='date'],[name='court_type']">
      <option value="">All</option>
      {% for st in surface_types %}
      <option value="{{ st }}" {% if st == filters.surface_type %}selected{% endif %}>{{ st | replace('_', ' ') | title }}</option>
      {% endfor %}
    </select>
    <span class="toolbar-label">Type</span>
    <select name="court_type"
            hx-get="/partials/clubs/{{ club.id }}/slots"
            hx-target="#slot-grid"
            hx-include="[name='date'],[name='surface_type']">
      <option value="">All</option>
      {% for ct in court_types %}
      <option value="{{ ct }}" {% if ct == filters.court_type %}selected{% endif %}>{{ ct | title }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="toolbar-divider"></div>

  <!-- Legend -->
  <div class="legend-inline">
    <span class="l-free">Free</span>
    <span class="l-booked">Booked</span>
    <span class="l-for-sale">For Sale</span>
  </div>
</div>

<!-- Slot grid (HTMX-swappable) -->
<div id="slot-grid">
  {% include "partials/slot_grid.html" %}
</div>

<!-- Notification CTA -->
<div class="notification-cta">
  <div class="cta-icon">ğŸ””</div>
  <div class="cta-text">
    <strong>Never miss an open court</strong>
    <p>Get notified when a slot frees up at {{ club.name }}.</p>
  </div>
  <a href="/notifications/new?club_id={{ club.id }}" role="button">Set up alert</a>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    flatpickr("#date-picker", {
      dateFormat: "Y-m-d",
      onChange: function(selectedDates, dateStr) {}
    });
  });
</script>
{% endblock %}
